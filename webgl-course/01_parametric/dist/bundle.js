(()=>{"use strict";var e,o,t,n,i,r=3,u=[];function a(e,o){for(var t=[0,0],n=e.length-1,i=0;i<=n;i++){var r=c(n,i)*Math.pow(o,i)*Math.pow(1-o,n-i);t[0]+=e[i][0]*r,t[1]+=e[i][1]*r}return t}function c(e,o){for(var t=1,n=0;n<o;n++)t*=(e-n)/(n+1);return t}var v=null;function l(){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),mat4.perspective(t.uniforms.projection.value,Math.PI/6,o.aspect_ratio(),.1,1e3);var c=t.uniforms.modelview;i.lookAt(c.value),e.lineWidth(1),t.color(.5,.5,.5),n.xygrid(100),t.color(1,.6,.2),t.begin(e.LINE_STRIP);for(var v=Number(document.getElementById("input_numsteps").value),l=0;l<=v;++l){var m=l/v;t.vertex2(a(u,m))}if(t.end(),document.getElementById("input_show_samplepoints").checked){for(t.begin(e.POINTS),l=0;l<=v;++l)m=l/v,t.vertex2(a(u,m));t.end()}if(document.getElementById("input_show_controlpoints").checked){t.color(.2,.5,1),t.begin(e.LINE_STRIP);for(var d=0;d<r;d++)t.vertex2(u[d]);t.end(),t.begin(e.POINTS);for(var s=0;s<r;s++)t.vertex2(u[s]);t.end()}}function m(){o=document.getElementById("canvas"),(e=o.getContext("experimental-webgl"))||alert("Could not initialise WebGL, sorry :-("),(t=get_legacygl(e,"        attribute vec3 a_vertex;        attribute vec3 a_color;        varying vec3 v_color;        uniform mat4 u_modelview;        uniform mat4 u_projection;        void main(void) {            gl_Position = u_projection * u_modelview * vec4(a_vertex, 1.0);            v_color = a_color;            gl_PointSize = 5.0;        }        ","        precision mediump float;        varying vec3 v_color;        void main(void) {            gl_FragColor = vec4(v_color, 1.0);        }        ")).add_uniform("modelview","Matrix4f"),t.add_uniform("projection","Matrix4f"),t.add_vertex_attribute("color",3),t.vertex2=function(e){this.vertex(e[0],e[1],0)},n=get_drawutil(e,t),(i=get_camera(o.width)).eye=[0,0,7],function(){u=[];for(var e=0;e<r;e++)u.push([1*Math.cos(2*Math.PI*e/r),1*Math.sin(2*Math.PI*e/r)])}(),o.onmousedown=function(e){var n=this.get_mousepos(e);if(e.altKey)i.start_moving(n,e.shiftKey?"zoom":"pan");else for(var a=[0,0,o.width,o.height],c=1e7,l=0;l<r;++l){var m=glu.project([u[l][0],u[l][1],0],t.uniforms.modelview.value,t.uniforms.projection.value,a),d=vec2.dist(n,m);d<c&&(c=d,v=u[l])}},o.onmousemove=function(e){var n=this.get_mousepos(e);if(i.is_moving())return i.move(n),void l();if(null!=v){var r=[0,0,o.width,o.height];n.push(1);var u=glu.unproject(n,t.uniforms.modelview.value,t.uniforms.projection.value,r),a=[0,0,1],c=vec3.sub([],u,i.eye),m=vec3.sub([],[0,0,0],i.eye),d=vec3.dot(c,a),s=vec3.dot(m,a),_=vec3.scale([],c,s/d);vec3.add(v,i.eye,_),l()}},document.onmouseup=function(e){i.is_moving()?i.finish_moving():v=null},e.viewport(0,0,o.width,o.height),e.clearColor(1,1,1,1)}window.onload=function(){m(),l();var e=document.getElementById("input_controlpoints");e.onchange=function(){var o;o=Number(e.value),r=o,m(),l()},document.getElementById("input_show_controlpoints").onchange=function(){l()},document.getElementById("input_numsteps").onchange=function(){l()},document.getElementById("input_show_samplepoints").onchange=function(){l()}}})();