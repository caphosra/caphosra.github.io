(()=>{"use strict";var e,o,t,n,i,a=[{position:[0,0],angle:0,length:.8},{position:[0,0],angle:0,length:.9},{position:[0,0],angle:0,length:1.5},{position:[0,0],angle:0,length:.7}];function r(){a.forEach((function(e,o){e.position=[0,0];for(var t=0,n=0;n<=o;++n)t+=a[n].angle,e.position[0]+=a[n].length*Math.cos(t*Math.PI/180),e.position[1]+=a[n].length*Math.sin(t*Math.PI/180)}))}var c=!1;function l(){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),mat4.perspective(t.uniforms.projection.value,Math.PI/6,o.aspect_ratio(),.1,1e3);var r=t.uniforms.modelview;i.lookAt(r.value),e.lineWidth(1),t.color(.5,.5,.5),n.xygrid(100);var c=Number(document.getElementById("input_selected").value);t.begin(e.LINES),a.forEach((function(e,o){o==c?t.color(1,0,0):t.color(0,0,0),0==o?t.vertex(0,0,0):t.vertex2(a[o-1].position),t.vertex2(e.position)})),t.end(),t.begin(e.POINTS),t.color(0,0,0),t.vertex(0,0,0),a.forEach((function(e,o){o==c?t.color(1,0,0):t.color(0,0,0),t.vertex2(e.position)})),t.end()}window.onload=function(){(function(){o=document.getElementById("canvas"),(e=o.getContext("experimental-webgl"))||alert("Could not initialise WebGL, sorry :-("),(t=get_legacygl(e,"        attribute vec3 a_vertex;        attribute vec3 a_color;        varying vec3 v_color;        uniform mat4 u_modelview;        uniform mat4 u_projection;        void main(void) {          gl_Position = u_projection * u_modelview * vec4(a_vertex, 1.0);          v_color = a_color;          gl_PointSize = 5.0;        }        ","        precision mediump float;        varying vec3 v_color;        void main(void) {          gl_FragColor = vec4(v_color, 1.0);        }        ")).add_uniform("modelview","Matrix4f"),t.add_uniform("projection","Matrix4f"),t.add_vertex_attribute("color",3),t.vertex2=function(e){this.vertex(e[0],e[1],0)},n=get_drawutil(e,t),(i=get_camera(o.width)).center=[2,0,0],i.eye=[2,0,7],r();var u=document.getElementById("input_selected"),v=document.getElementById("input_angle"),d=document.getElementById("ik_mode"),s=document.getElementById("fk_mode");o.onmousedown=function(e){this.get_mousepos(e),d.checked&&(c=!0)},o.onmousemove=function(e){if(c){var n=this.get_mousepos(e);n.push(1);var v=[0,0,o.width,o.height],d=glu.unproject(n,t.uniforms.modelview.value,t.uniforms.projection.value,v),s=[0,0,1],g=vec3.sub([],d,i.eye),m=vec3.sub([],[0,0,0],i.eye),h=vec3.dot(g,s),p=vec3.dot(m,s),f=vec3.scale([],g,p/h),_=vec3.add([],i.eye,f);!function(e){for(var o=a.length,t=0;t<10;t++)for(var n=o-1;n>=0;n--){var i=0==n?e[0]:e[0]-a[n-1].position[0],c=0==n?e[1]:e[1]-a[n-1].position[1],l=0==n?a[o-1].position[0]:a[o-1].position[0]-a[n-1].position[0],u=0==n?a[o-1].position[1]:a[o-1].position[1]-a[n-1].position[1];if(0!==i||0!==c){var v=Math.atan2(c,i);if(0!==l||0!==u){var d=Math.atan2(u,l);a[n].angle+=180*(v-d)/Math.PI,a[n].angle%=360,r()}}}}([_[0],_[1]]),l(),u.onchange(void 0)}},document.onmouseup=function(e){c=!1},d.onchange=function(e){d.checked&&(u.disabled=!0,v.disabled=!0)},s.onchange=function(e){s.checked&&(u.disabled=!1,v.disabled=!1)},u.max=(a.length-1).toString(),u.onchange=function(){v.value=a[u.value].angle,l()},v.onchange=function(){var e=Number(u.value);a[e].angle=Number(v.value),r(),l()},e.viewport(0,0,o.width,o.height),e.clearColor(1,1,1,1)})(),l()}})();