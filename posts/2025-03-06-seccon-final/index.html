<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="caphosra"><meta name=description content="SECCON CTF 13 Domestic FinalsにTSGとして参加したのでwriteupを公開します。"><meta name=keywords content="ctf,seccon,seccon 13,writeup,allegro"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://caphosra.net/images/icon.webp"><meta name=twitter:title content="[CTF] SECCON CTF 13 Domestic Finals writeup"><meta name=twitter:description content="SECCON CTF 13 Domestic FinalsにTSGとして参加したのでwriteupを公開します。"><meta property="og:url" content="https://caphosra.net/posts/2025-03-06-seccon-final/"><meta property="og:site_name" content="caphosra note"><meta property="og:title" content="[CTF] SECCON CTF 13 Domestic Finals writeup"><meta property="og:description" content="SECCON CTF 13 Domestic FinalsにTSGとして参加したのでwriteupを公開します。"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-06T16:24:45+09:00"><meta property="article:modified_time" content="2025-03-06T20:48:40+09:00"><meta property="article:tag" content="CTF"><base href=https://caphosra.net/posts/2025-03-06-seccon-final/><title>[CTF] SECCON CTF 13 Domestic Finals writeup · caphosra note</title><link rel=canonical href=https://caphosra.net/posts/2025-03-06-seccon-final/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><style defer>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap'</style><link rel=stylesheet href=https://caphosra.net/css/coder.min.e785694f058b8c1433bda14011e401202da0cbde72fc8f9e2ec92a230112ba08.css integrity="sha256-54VpTwWLjBQzvaFAEeQBIC2gy95y/I+eLskqIwESugg=" crossorigin=anonymous media=screen><script src=https://cdn.jsdelivr.net/npm/gist-embed@1.0.3/dist/gist-embed.min.js defer></script><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.148.2"><style type=text/css>.icon{font-size:2.5em}</style></head><body class=colorscheme-light><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://caphosra.net/>caphosra note
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://caphosra.net/>About</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/archives/>Archives</a></li><li class=navigation-item><a class=navigation-link href=https://github.com/caphosra>GitHub</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://caphosra.net/en/>English</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://caphosra.net/posts/2025-03-06-seccon-final/>[CTF] SECCON CTF 13 Domestic Finals writeup</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2025-03-06T16:24:45+09:00>3月 6, 2025
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
11分で読めます</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://caphosra.net/tags/ctf/>CTF</a></span></div></div></header><div class=post-content><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><p>SECCON CTF 13の国内決勝にTSGのrev枠として参加し、3位を取ることができた。自分が張り付いていたAllegroの順位は8位だったので心境は複雑だが、ともあれwriteupを書きたいと思う。</p><h2 id=king-of-the-hill-allegro>King of the Hill: Allegro
<a class=heading-link href=#king-of-the-hill-allegro><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>人生初のKing of the Hillとなった。　x86_64のバイナリが与えられ、そのバイナリの出力を変えずにいかに高速化できるかを競う問題であった。実質的にrevパートと最適化を行うパートに二分されていた。</p><p>より詳細なルールとしては、1ラウンド2-3時間で各ラウンドの最初にx86_64のバイナリが配布された。プレイヤーはそれを高速化したものを提出すると、5分おきに、そのプログラムが十分高速でかつテストを通る場合、その速度に応じた点が加算されていくというものであった。これが6ラウンド、つまり会場が空いている間ずっとあったので、Allegroを取り組むプレイヤーはこの問題に張り付いておかないといけなかった。</p><h3 id=round1-普通のx86_64のプログラム>Round1: &ldquo;普通"のx86_64のプログラム
<a class=heading-link href=#round1-%e6%99%ae%e9%80%9a%e3%81%aex86_64%e3%81%ae%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%a0><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h3><p>Ghidraでデコンパイルすると以下のようなCのコードが得られた。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#e5c07b>long</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#aa89ea>param_1</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>lVar1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>lVar2</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>lVar3</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>else</span> <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>else</span> <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>lVar1</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>+</span> <span style=color:#54b1c7>-</span><span style=color:#d19a66>3</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>lVar2</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>+</span> <span style=color:#54b1c7>-</span><span style=color:#d19a66>2</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>lVar3</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>+</span> <span style=color:#54b1c7>-</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>param_1</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>lVar1</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>lVar2</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>-</span> <span style=color:#aa89ea>lVar3</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>param_1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>undefined8</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>void</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>undefined8</span> <span style=color:#aa89ea>uVar1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>in_FS_OFFSET</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ulong</span> <span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>local_10</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>local_10</span> <span style=color:#54b1c7>=</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>in_FS_OFFSET</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>0x28</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>__isoc99_scanf</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>DAT_00102004</span><span style=color:#abb2bf>,</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#d19a66>3</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>sleep</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>5</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>uVar1</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%llu</span><span style=color:#d26464;font-weight:700>\n</span><span style=color:#98c379>&#34;</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>uVar1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_10</span> <span style=color:#54b1c7>!=</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>in_FS_OFFSET</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>0x28</span><span style=color:#abb2bf>))</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>/* WARNING: Subroutine does not return */</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>__stack_chk_fail</span><span style=color:#abb2bf>();</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></div><p>不要な<code>sleep(5)</code>を除去しつつ、<code>f</code>の再帰をループにして<code>-O3</code>オプションをつけてコンパイルして提出した。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#include</span> <span style=color:#8a93a5;font-style:italic>&lt;stdio.h&gt;</span><span style=color:#8a93a5;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>int</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>void</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>num</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>scanf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lld&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>num</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>num</span> <span style=color:#54b1c7>&lt;=</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>puts</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;1&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>f0</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>f1</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>f2</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>fn</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>3</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>&lt;=</span> <span style=color:#aa89ea>num</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>fn</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>f0</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>f1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>-</span> <span style=color:#aa89ea>f2</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>f0</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>f1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>f1</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>f2</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>f2</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>fn</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%llu</span><span style=color:#d26464;font-weight:700>\n</span><span style=color:#98c379>&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>fn</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></div><p>結果は以下の通り。</p><figure><img src=https://caphosra.net/images/2025-03-06/allegro1.png alt="Allegro Round1の結果"></figure><h3 id=round2-難読化されたx86_64のプログラム>Round2: 難読化されたx86_64のプログラム
<a class=heading-link href=#round2-%e9%9b%a3%e8%aa%ad%e5%8c%96%e3%81%95%e3%82%8c%e3%81%9fx86_64%e3%81%ae%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%a0><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h3><p>Ghidraでサッとデコンパイルしても何しているかわからないプログラムが出てきた。<code>strings</code>を使うと</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>UPX 4.24 Copyright (C) 1996-2024 the UPX Team. All Rights Reserved
</span></span></code></pre></div><p>と出てきたので<code>upx -d</code>も試したが、流石に対策されているようでうまくいかなかった。改造したupxを使っているのだろう。</p><p>入力<code>42</code>を与えて<code>strace</code>すると</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>...
</span></span><span style=display:flex><span>read(0, &#34;4&#34;, 1)                         = 1
</span></span><span style=display:flex><span>clock_nanosleep(CLOCK_REALTIME, 0, {tv_sec=0, tv_nsec=1000000}, NULL) = 0
</span></span><span style=display:flex><span>read(0, &#34;2&#34;, 1)                         = 1
</span></span><span style=display:flex><span>clock_nanosleep(CLOCK_REALTIME, 0, {tv_sec=0, tv_nsec=1000000}, NULL) = 0
</span></span><span style=display:flex><span>read(0, &#34;\n&#34;, 1)                        = 1
</span></span><span style=display:flex><span>clock_nanosleep(CLOCK_REALTIME, 0, {tv_sec=0, tv_nsec=1000000}, NULL) = 0
</span></span><span style=display:flex><span>read(0, &#34;&#34;, 1)                          = 0
</span></span><span style=display:flex><span>fstat(1, {st_mode=S_IFREG|0664, st_size=4563, ...}) = 0
</span></span><span style=display:flex><span>write(1, &#34;63b58bab\n&#34;, 963b58bab
</span></span><span style=display:flex><span>)               = 9
</span></span><span style=display:flex><span>exit_group(0)                           = ?
</span></span><span style=display:flex><span>+++ exited with 0 +++
</span></span></code></pre></div><p>という出力が得られた。1文字ずつ<code>read</code>して何かの操作を行なっているようなので、<code>read</code>にbreakpointsを設定してgdbデバッグを敢行し、以下のプログラムと同等であることを掴んだ。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#aa89ea>x</span> <span style=color:#54b1c7>=</span> <span style=color:#e5c07b>input</span><span style=color:#abb2bf>()</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>encode</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>res</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0xffffffff</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>i</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#e5c07b>range</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>x</span><span style=color:#abb2bf>)):</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>res</span> <span style=color:#54b1c7>^=</span> <span style=color:#aa89ea>x</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>i</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#e5c07b>range</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>8</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>res</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>res</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>^</span> <span style=color:#abb2bf>(((</span><span style=color:#d19a66>0xffffffff</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>-</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>res</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>))</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x82f63b78</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>print</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>hex</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0xffffffff</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#54b1c7>~</span><span style=color:#aa89ea>res</span><span style=color:#abb2bf>))</span>
</span></span></code></pre></div><p>これをCに書き直して提出したが時すでに遅し。しかもCへの移植をどこかミスしてしまったようである。</p><figure><img src=https://caphosra.net/images/2025-03-06/allegro2.png alt="Allegro Round2の結果"></figure><h3 id=round3-独自vm風の何か>Round3: 独自VM風の何か
<a class=heading-link href=#round3-%e7%8b%ac%e8%87%aavm%e9%a2%a8%e3%81%ae%e4%bd%95%e3%81%8b><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h3><p>Ghidraでデコンパイルすると以下のような見た目になる。<code>OP1</code>から<code>OP9</code>までの命令とレジスタ<code>R0</code>から<code>R9</code>をもつVMで、最終的に結果としてレジスタの情報を出力することがわかる。関数のprefixからpythonで書かれていそうだが、問題にPythonの仕様絡みの話が関わってくることはなかった。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#abb2bf>...</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>do</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>ulong</span><span style=color:#abb2bf>)(</span><span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>iVar3</span> <span style=color:#54b1c7>&lt;=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>ulong</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_78</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_78</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>10</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_78</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_78</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#00b1f7>printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;R%ld: 0x%08x</span><span style=color:#d26464;font-weight:700>\n</span><span style=color:#98c379>&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>local_78</span><span style=color:#abb2bf>,</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>ulong</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>*</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>uint</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>local_78</span> <span style=color:#54b1c7>*</span> <span style=color:#d19a66>4</span> <span style=color:#54b1c7>+</span> <span style=color:#54b1c7>-</span><span style=color:#d19a66>8</span><span style=color:#abb2bf>));</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>uVar5</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>uVar5</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar6</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>py_list_getitem</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>uVar5</span><span style=color:#abb2bf>,</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>ulong</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar7</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>py_tuple_getitem</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar6</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>py_tuple_getitem</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>__s1</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>char</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)</span><span style=color:#00b1f7>py_tostr</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>uVar7</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>strcmp</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>__s1</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;OP1&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00b1f7>vm_insn_op1</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>strcmp</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>__s1</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;OP2&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#00b1f7>vm_insn_op2</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>strcmp</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>__s1</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;OP3&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                <span style=color:#00b1f7>vm_insn_op3</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>strcmp</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>__s1</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;OP4&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#00b1f7>vm_insn_op4</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>strcmp</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>__s1</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;OP5&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                        <span style=color:#00b1f7>vm_insn_op5</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                        <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>strcmp</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>__s1</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;OP6&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                            <span style=color:#00b1f7>vm_insn_op6</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                            <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>strcmp</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>__s1</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;OP7&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                            <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                                <span style=color:#00b1f7>vm_insn_op7</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                            <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                                <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>strcmp</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>__s1</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;OP8&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                                <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                                    <span style=color:#00b1f7>vm_insn_op8</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                                <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                                    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>strcmp</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>__s1</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;OP9&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                                    <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>!=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                                        <span style=color:#00b1f7>fwrite</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;Invalid opcode</span><span style=color:#d26464;font-weight:700>\n</span><span style=color:#98c379>&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0xf</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>stderr</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                                        <span style=color:#aa89ea>uVar5</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>                                        <span style=color:#76a9f9>goto</span> <span style=color:#aa89ea>LAB_00105511</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>                                    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>                                    <span style=color:#00b1f7>vm_insn_op9</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>uVar6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                                <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>                            <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>                        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>                <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>            <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>undefined</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>8</span><span style=color:#abb2bf>])((</span><span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span> <span style=color:#76a9f9>while</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>true</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>...</span>
</span></span></code></pre></div><p>ちなみに<code>OP1</code>は即値代入、<code>OP2</code>はmov、<code>OP3-6</code>は四則演算で、<code>OP7</code>はRISC-Vでいうところの<code>beq</code>、<code>OP8</code>は<code>bne</code>、<code>OP9</code>は<code>jmp</code>であった。</p><p>仕様はわかったのであとはこれを実装すればいい。しかし、愚直な実装をすると、他チームより遅い結果になったり、最後の方に待っている厳しいテストケースを制限時間内に通過しなくなったりすることが想定されるので、JITするプログラムを実装することにした。方針としては<code>mprotect</code>で適当に実行可能領域を確保してpwntoolsであらかじめ生成しておいたコード片から対応する命令を書き込んでいくことにした。ジャンプ命令が絡むものは仕方がないのでその場でディスアセンブルすることにした。</p><p>ただ、KoHの性質上、JITを実装している間も他チームに点が入り続けてしまうので、仮としてジャンプ命令を<code>nop</code>としてみる嘘解法を提出した。通った場合は他のどのチームより高い点がもらえ、通らなかったとしても多くのチームがTLEしている関係上そこまで痛手にならない。結果的にこの作戦によりかなりの点を取ることに成功した。</p><p>結局、JITするプログラムはバグらせてしまったので、ただ嘘解法を提出しただけになってしまった。</p><figure><img src=https://caphosra.net/images/2025-03-06/allegro3.png alt="Allegro Round3の結果"></figure><p>余談ではあるが、このバイナリはレジスタ番号が<code>0-9</code>の範囲内かどうかを判定していない。ゆえ、<code>OP2</code>を使ってレジスタ<code>Rn</code>の値を<code>R0</code>などのレジスタに読み出すことで範囲外参照をすることができ、本来読めないメモリ上の値を読み出すことができる。&ldquo;真に"挙動を再現するべきであるならば、この脆弱性も再現する必要があったのだろう。</p><h3 id=round4-python>Round4: Python
<a class=heading-link href=#round4-python><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h3><p><code>strace</code>をすると、</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f767f42f350) = 96023
</span></span></code></pre></div><p>と言う部分があり、<code>clone</code>を使って新しいプロセスを作っていることがわかる。<code>clone</code>された後の処理を追うためにgdbでデバッグしていると大量の<code>PyEval_EvalCode</code>に遭遇した。どうやら<code>cpython</code>を呼んでPythonのバイトコードを実行しているプログラムのようである。</p><p>あとはPythonのバイトコードを抽出したい。<code>cpython</code>のソースコードを読んだりネット検索を行ったりした結果、<code>PyEval_EvalCode</code>が内部で呼んでいる<code>_PyEval_EvalFrameDefault</code>の引数がどうやらPythonのバイトコードを保持しているようだということがわかった。しかし、最後までどのような形式で格納されているのか掴めずに時間を浪費し、結局何も提出できずに終わってしまった。</p><figure><img src=https://caphosra.net/images/2025-03-06/allegro4.png alt="Allegro Round4の結果"></figure><p>余談ではあるが、この問題が出て割とすぐに会場中から「Pythonかぁ〜」という落胆のような声がいくつか聞こえた。&ldquo;素直な"x86_64のバイナリはもうお目にかかれないのだろうな、と皆思ったのかもしれない。</p><h3 id=round5-lua>Round5: Lua
<a class=heading-link href=#round5-lua><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h3><p>Ghidraでデコンパイルすると以下の通り。Luaのバイトコードを実行していることがわかる。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#aa89ea>undefined8</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>void</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>int</span> <span style=color:#aa89ea>iVar1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>undefined8</span> <span style=color:#aa89ea>uVar2</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>in_FS_OFFSET</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ulong</span> <span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>undefined8</span> <span style=color:#aa89ea>local_50</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ulong</span> <span style=color:#aa89ea>local_48</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ulong</span> <span style=color:#aa89ea>local_40</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ulong</span> <span style=color:#aa89ea>local_38</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ulong</span> <span style=color:#aa89ea>local_30</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ulong</span> <span style=color:#aa89ea>local_28</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ulong</span> <span style=color:#aa89ea>local_20</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>local_10</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>local_10</span> <span style=color:#54b1c7>=</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>in_FS_OFFSET</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>0x28</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>local_18</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>luaL_newstate</span><span style=color:#abb2bf>();</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar2</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>luaL_loadbufferx</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>bytecode</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xfffffffff2e80000</span><span style=color:#abb2bf>,</span><span style=color:#98c379>&#34;embedded&#34;</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&amp;&amp;</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>lua_pcallk</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>),</span> <span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>))</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#00b1f7>__isoc99_scanf</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>DAT_004c13c1</span><span style=color:#abb2bf>,</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#00b1f7>lua_getglobal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>DAT_004c13c5</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#00b1f7>lua_getglobal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>DAT_004c13c7</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#00b1f7>lua_getglobal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>DAT_004c13c7</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#00b1f7>lua_createtable</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_58</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00b1f7>lua_createtable</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_58</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>          <span style=color:#00b1f7>__isoc99_scanf</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>DAT_004c13c9</span><span style=color:#abb2bf>,</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>local_50</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>          <span style=color:#00b1f7>lua_pushinteger</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_50</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>          <span style=color:#00b1f7>lua_rawseti</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xfffffffe</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#00b1f7>lua_rawseti</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xfffffffe</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>      <span style=color:#00b1f7>lua_createtable</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_58</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00b1f7>lua_createtable</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_58</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_30</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_30</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_30</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_30</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>          <span style=color:#00b1f7>__isoc99_scanf</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>DAT_004c13c9</span><span style=color:#abb2bf>,</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>local_50</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>          <span style=color:#00b1f7>lua_pushinteger</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_50</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>          <span style=color:#00b1f7>lua_rawseti</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xfffffffe</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_30</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#00b1f7>lua_rawseti</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xfffffffe</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>lua_pcallk</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>2</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00b1f7>lua_pushvalue</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>lua_pcallk</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>2</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&amp;&amp;</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>lua_pcallk</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>),</span> <span style=color:#aa89ea>iVar1</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>))</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>          <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#00b1f7>lua_rawgeti</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#00b1f7>putchar</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0x5b</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_20</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_20</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_20</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_20</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>              <span style=color:#00b1f7>lua_rawgeti</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_20</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>              <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_20</span> <span style=color:#54b1c7>==</span> <span style=color:#aa89ea>local_58</span> <span style=color:#54b1c7>-</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                <span style=color:#aa89ea>uVar2</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>lua_tointegerx</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                <span style=color:#00b1f7>printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lld&#34;</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>uVar2</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>              <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>              <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                <span style=color:#aa89ea>uVar2</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>lua_tointegerx</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>                <span style=color:#00b1f7>printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lld, &#34;</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>uVar2</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>              <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>              <span style=color:#00b1f7>lua_settop</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xfffffffe</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>            <span style=color:#00b1f7>puts</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;]&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#00b1f7>lua_settop</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0xfffffffe</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>          <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>      <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>lua_close</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_18</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar2</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_10</span> <span style=color:#54b1c7>==</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>in_FS_OFFSET</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>0x28</span><span style=color:#abb2bf>))</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>uVar2</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#8a93a5;font-style:italic>/* WARNING: Subroutine does not return */</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>__stack_chk_fail</span><span style=color:#abb2bf>();</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></div><p>幸いなことに、Pythonの時と異なり、bytecodeという名前のsymbolが残っているので簡単にluaのバイトコードを取り出すことができた。問題はluaのバージョンであるが、<code>strings</code>すると、</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$LuaVersion: Lua 5.4.6  Copyright (C) 1994-2023 Lua.org, PUC-Rio $$LuaAuthors: R. Ierusalimschy, L. H. de Figueiredo, W. Celes $
</span></span></code></pre></div><p>という文字列が見つかったので、Lua 5.4.6とみて良いだろう。すぐにlua 5.4.6をダウンロードしてきて<code>luac</code>を使ってバイトコードを復号し以下のようなもの(一部割愛)を得た。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#aa89ea>main</span> <span style=color:#54b1c7>&lt;</span><span style=color:#aa89ea>main</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>lua</span><span style=color:#abb2bf>:</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>0</span><span style=color:#54b1c7>&gt;</span> <span style=color:#abb2bf>(</span><span style=color:#d19a66>8</span> <span style=color:#aa89ea>instructions</span> <span style=color:#aa89ea>at</span> <span style=color:#d19a66>0x55ad1e4a0c80</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#d19a66>0</span><span style=color:#54b1c7>+</span> <span style=color:#aa89ea>params</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>2</span> <span style=color:#aa89ea>slots</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>1</span> <span style=color:#aa89ea>upvalue</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0</span> <span style=color:#aa89ea>locals</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>3</span> <span style=color:#aa89ea>constants</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>3</span> <span style=color:#aa89ea>functions</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>1</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>VARARGPREP</span>	<span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>2</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>12</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>CLOSURE</span>  	<span style=color:#d19a66>0</span> <span style=color:#d19a66>0</span>	<span style=color:#abb2bf>;</span> <span style=color:#d19a66>0x55ad1e4a0e80</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>3</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>SETTABUP</span> 	<span style=color:#d19a66>0</span> <span style=color:#d19a66>0</span> <span style=color:#d19a66>0</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>_ENV</span> <span style=color:#63c381>&#34;H&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>4</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>23</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>CLOSURE</span>  	<span style=color:#d19a66>0</span> <span style=color:#d19a66>1</span>	<span style=color:#abb2bf>;</span> <span style=color:#d19a66>0x55ad1e4a1140</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>5</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>14</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>SETTABUP</span> 	<span style=color:#d19a66>0</span> <span style=color:#d19a66>1</span> <span style=color:#d19a66>0</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>_ENV</span> <span style=color:#63c381>&#34;G&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>6</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>37</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>CLOSURE</span>  	<span style=color:#d19a66>0</span> <span style=color:#d19a66>2</span>	<span style=color:#abb2bf>;</span> <span style=color:#d19a66>0x55ad1e4a1390</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>7</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>25</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>SETTABUP</span> 	<span style=color:#d19a66>0</span> <span style=color:#d19a66>2</span> <span style=color:#d19a66>0</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>_ENV</span> <span style=color:#63c381>&#34;F&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>8</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>37</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>RETURN</span>   	<span style=color:#d19a66>0</span> <span style=color:#d19a66>1</span> <span style=color:#d19a66>1</span>	<span style=color:#abb2bf>;</span> <span style=color:#d19a66>0</span> <span style=color:#aa89ea>out</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>constants</span> <span style=color:#abb2bf>(</span><span style=color:#d19a66>3</span><span style=color:#abb2bf>)</span> <span style=color:#76a9f9>for</span> <span style=color:#d19a66>0x55ad1e4a0c80</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>0</span>	<span style=color:#aa89ea>S</span>	<span style=color:#63c381>&#34;H&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>1</span>	<span style=color:#aa89ea>S</span>	<span style=color:#63c381>&#34;G&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>2</span>	<span style=color:#aa89ea>S</span>	<span style=color:#63c381>&#34;F&#34;</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>locals</span> <span style=color:#abb2bf>(</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#76a9f9>for</span> <span style=color:#d19a66>0x55ad1e4a0c80</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>upvalues</span> <span style=color:#abb2bf>(</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#76a9f9>for</span> <span style=color:#d19a66>0x55ad1e4a0c80</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>0</span>	<span style=color:#aa89ea>_ENV</span>	<span style=color:#d19a66>1</span>	<span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>function</span> <span style=color:#54b1c7>&lt;</span><span style=color:#aa89ea>main</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>lua</span><span style=color:#abb2bf>:</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span><span style=color:#d19a66>12</span><span style=color:#54b1c7>&gt;</span> <span style=color:#abb2bf>(</span><span style=color:#d19a66>19</span> <span style=color:#aa89ea>instructions</span> <span style=color:#aa89ea>at</span> <span style=color:#d19a66>0x55ad1e4a0e80</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#d19a66>3</span> <span style=color:#aa89ea>params</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>7</span> <span style=color:#aa89ea>slots</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0</span> <span style=color:#aa89ea>upvalues</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>11</span> <span style=color:#aa89ea>locals</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0</span> <span style=color:#aa89ea>constants</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0</span> <span style=color:#aa89ea>functions</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>1</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>2</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>LTI</span>      	<span style=color:#d19a66>2</span> <span style=color:#d19a66>0</span> <span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>2</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>2</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>JMP</span>      	<span style=color:#d19a66>8</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>to</span> <span style=color:#d19a66>11</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>3</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>3</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>LOADI</span>    	<span style=color:#d19a66>3</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>4</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>3</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>UNM</span>      	<span style=color:#d19a66>4</span> <span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>5</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>3</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>LOADI</span>    	<span style=color:#d19a66>5</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>6</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>3</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>FORPREP</span>  	<span style=color:#d19a66>3</span> <span style=color:#d19a66>2</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>exit</span> <span style=color:#aa89ea>to</span> <span style=color:#d19a66>10</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>7</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>4</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>SUB</span>      	<span style=color:#d19a66>0</span> <span style=color:#d19a66>0</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>8</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>4</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>MMBIN</span>    	<span style=color:#d19a66>0</span> <span style=color:#d19a66>1</span> <span style=color:#d19a66>7</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>__sub</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>9</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>3</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>FORLOOP</span>  	<span style=color:#d19a66>3</span> <span style=color:#d19a66>3</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>to</span> <span style=color:#d19a66>7</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>10</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>5</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>JMP</span>      	<span style=color:#d19a66>7</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>to</span> <span style=color:#d19a66>18</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>11</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>7</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>LOADI</span>    	<span style=color:#d19a66>3</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>12</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>7</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>MOVE</span>     	<span style=color:#d19a66>4</span> <span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>13</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>7</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>LOADI</span>    	<span style=color:#d19a66>5</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>14</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>7</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>FORPREP</span>  	<span style=color:#d19a66>3</span> <span style=color:#d19a66>2</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>exit</span> <span style=color:#aa89ea>to</span> <span style=color:#d19a66>18</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>15</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>8</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>ADD</span>      	<span style=color:#d19a66>0</span> <span style=color:#d19a66>0</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>16</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>8</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>MMBIN</span>    	<span style=color:#d19a66>0</span> <span style=color:#d19a66>1</span> <span style=color:#d19a66>6</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>__add</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>17</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>7</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>FORLOOP</span>  	<span style=color:#d19a66>3</span> <span style=color:#d19a66>3</span>	<span style=color:#abb2bf>;</span> <span style=color:#aa89ea>to</span> <span style=color:#d19a66>15</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>18</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>11</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>RETURN1</span>  	<span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>19</span>	<span style=color:#abb2bf>[</span><span style=color:#d19a66>12</span><span style=color:#abb2bf>]</span>	<span style=color:#aa89ea>RETURN0</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>constants</span> <span style=color:#abb2bf>(</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#76a9f9>for</span> <span style=color:#d19a66>0x55ad1e4a0e80</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>locals</span> <span style=color:#abb2bf>(</span><span style=color:#d19a66>11</span><span style=color:#abb2bf>)</span> <span style=color:#76a9f9>for</span> <span style=color:#d19a66>0x55ad1e4a0e80</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>0</span>	<span style=color:#aa89ea>a</span>	<span style=color:#d19a66>1</span>	<span style=color:#d19a66>20</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>1</span>	<span style=color:#aa89ea>b</span>	<span style=color:#d19a66>1</span>	<span style=color:#d19a66>20</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>2</span>	<span style=color:#aa89ea>c</span>	<span style=color:#d19a66>1</span>	<span style=color:#d19a66>20</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>3</span>	<span style=color:#abb2bf>(</span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>)</span>	<span style=color:#d19a66>6</span>	<span style=color:#d19a66>10</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>4</span>	<span style=color:#abb2bf>(</span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>)</span>	<span style=color:#d19a66>6</span>	<span style=color:#d19a66>10</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>5</span>	<span style=color:#abb2bf>(</span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>)</span>	<span style=color:#d19a66>6</span>	<span style=color:#d19a66>10</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>6</span>	<span style=color:#aa89ea>i</span>	<span style=color:#d19a66>7</span>	<span style=color:#d19a66>9</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>7</span>	<span style=color:#abb2bf>(</span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>)</span>	<span style=color:#d19a66>14</span>	<span style=color:#d19a66>18</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>8</span>	<span style=color:#abb2bf>(</span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>)</span>	<span style=color:#d19a66>14</span>	<span style=color:#d19a66>18</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>9</span>	<span style=color:#abb2bf>(</span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>)</span>	<span style=color:#d19a66>14</span>	<span style=color:#d19a66>18</span>
</span></span><span style=display:flex><span>	<span style=color:#d19a66>10</span>	<span style=color:#aa89ea>i</span>	<span style=color:#d19a66>15</span>	<span style=color:#d19a66>17</span>
</span></span><span style=display:flex><span><span style=color:#54b1c7>...</span>
</span></span></code></pre></div><p>どうやら3重ループを回しているようである。最初はこれを真面目に解析しようと試みて、かなりの時間を溶かした。</p><p>途中で、入力形式が数字\(n\)とそれに続いて\(2n^2\)個の数字が与えられるものであることと、3重ループという計算量から何かしらの行列計算であると踏んで処理内容をエスパーする方向に転換した。行列の対角成分の1つを\(m\)倍にすると結果の値が\(m^2\)倍で反応することや、単位行列を与えるともう片方の行列の2次式が帰ってくることなどから推察して、最終的に\((B^\top A^\top)(B^\top A^\top)\)であるという結論に達した。</p><p>あとはこれを計算するCのコードを書いて提出した。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#include</span> <span style=color:#8a93a5;font-style:italic>&lt;stdio.h&gt;</span><span style=color:#8a93a5;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#include</span> <span style=color:#8a93a5;font-style:italic>&lt;stdlib.h&gt;</span><span style=color:#8a93a5;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>void</span> <span style=color:#00b1f7>matmul</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>n</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#aa89ea>a</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#aa89ea>result</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>n</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>n</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>result</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>            <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>k</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>k</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>n</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>k</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                <span style=color:#aa89ea>result</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>+=</span> <span style=color:#aa89ea>a</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>k</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>*</span> <span style=color:#aa89ea>b</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>k</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>];</span>
</span></span><span style=display:flex><span>            <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>int</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>a</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>scanf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lld&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>a</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#aa89ea>b</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#abb2bf>)</span><span style=color:#00b1f7>malloc</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>*</span> <span style=color:#76a9f9>sizeof</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>));</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#aa89ea>c</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#abb2bf>)</span><span style=color:#00b1f7>malloc</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>*</span> <span style=color:#76a9f9>sizeof</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>));</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#aa89ea>bc</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#abb2bf>)</span><span style=color:#00b1f7>malloc</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>*</span> <span style=color:#76a9f9>sizeof</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>));</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#aa89ea>bc_bc</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>**</span><span style=color:#abb2bf>)</span><span style=color:#00b1f7>malloc</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>*</span> <span style=color:#76a9f9>sizeof</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>a</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>b</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)</span><span style=color:#00b1f7>malloc</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>*</span> <span style=color:#76a9f9>sizeof</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>));</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>c</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)</span><span style=color:#00b1f7>malloc</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>*</span> <span style=color:#76a9f9>sizeof</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>));</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>bc</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)</span><span style=color:#00b1f7>malloc</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>*</span> <span style=color:#76a9f9>sizeof</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>));</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>bc_bc</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)</span><span style=color:#00b1f7>malloc</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>*</span> <span style=color:#76a9f9>sizeof</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>));</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>prev</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>a</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>a</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#76a9f9>if</span><span style=color:#abb2bf>(</span><span style=color:#00b1f7>scanf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lld&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>])</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                <span style=color:#aa89ea>b</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>prev</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>            <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>prev</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>b</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>];</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>a</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>a</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#76a9f9>if</span><span style=color:#abb2bf>(</span><span style=color:#00b1f7>scanf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lld&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>c</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>])</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>                <span style=color:#aa89ea>c</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>prev</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>            <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>prev</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>c</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>];</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>matmul</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>c</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>b</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>bc</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>matmul</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>a</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>bc</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>bc</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>bc_bc</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>a</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00b1f7>putchar</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#39;[&#39;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>long</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>a</span> <span style=color:#54b1c7>-</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#00b1f7>printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lld, &#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>bc_bc</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>j</span><span style=color:#abb2bf>]);</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#00b1f7>printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lld&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>bc_bc</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>][</span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>-</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>]);</span>
</span></span><span style=display:flex><span>        <span style=color:#00b1f7>puts</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;]&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></div><p>最初のバージョンでは誤って行列をローカル変数として定義してしまったがために、大きい入力が来るとスタック領域を食い潰してエラー落ちするという初歩的なミスを犯してしまった。エスパーして解答を得ていたので、「もしかしたら"本当の式"はこれではないのかもしれない」と疑ってプログラムの誤りを疑わなかったので、結構なラウンドをドブに捨ててしまった。</p><figure><img src=https://caphosra.net/images/2025-03-06/allegro5.png alt="Allegro Round5の結果"></figure><p>余談ではあるが、この問題が出て割とすぐに会場中から「Luaかぁ〜」という落胆のような声がいくつか聞こえた。</p><h3 id=round6-無意味な演算を大量に含んだbit演算>Round6: 無意味な演算を大量に含んだbit演算
<a class=heading-link href=#round6-%e7%84%a1%e6%84%8f%e5%91%b3%e3%81%aa%e6%bc%94%e7%ae%97%e3%82%92%e5%a4%a7%e9%87%8f%e3%81%ab%e5%90%ab%e3%82%93%e3%81%a0bit%e6%bc%94%e7%ae%97><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h3><p>とりあえずGhidraにかけると、以下のようなCPUの情報をとってくる無意味なコードが大量に混じっていることがわかった。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#abb2bf>...</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar5</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>cpuid_basic_info</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>else</span> <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar5</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>cpuid_Version_info</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>else</span> <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar5</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>cpuid_cache_tlb_info</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>2</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>else</span> <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar5</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>3</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>cpuid_serial_info</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>3</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>else</span> <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar5</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>4</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>cpuid_Deterministic_Cache_Parameters_info</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>4</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>else</span> <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar5</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>5</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>cpuid_MONITOR_MWAIT_Features_info</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>5</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>else</span> <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar5</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>6</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>cpuid_Thermal_Power_Management_info</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>6</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>else</span> <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>iVar5</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>7</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>cpuid_Extended_Feature_Enumeration_info</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>7</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>...</span>
</span></span></code></pre></div><p>とりあえずこれらを一括置換で消してしまっても良いか、と思ったが、</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#aa89ea>n</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>cpu_id</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>...</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>m</span> <span style=color:#54b1c7>=</span> <span style=color:#00b1f7>cpu_id</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>...</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>ans</span> <span style=color:#54b1c7>+=</span> <span style=color:#aa89ea>n</span> <span style=color:#54b1c7>/</span> <span style=color:#aa89ea>m</span><span style=color:#abb2bf>;</span>
</span></span></code></pre></div><p>のように環境に依存しない定数を作り出して計算結果に混ぜている可能性が否定できなかったので、手動で除去をした。結果的には杞憂であったので数分無駄にしてしまったが依存している場合に沼にハマっていたと思うのでやって良かったと思う。</p><p>そうすると以下のようなコード(一部割愛)を得る。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#e5c07b>int</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>void</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_48</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_58</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>piVar1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>puVar2</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>0x20</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>local_68</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#abb2bf>((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>*</span> <span style=color:#98c379>&#39;\x02&#39;</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x3f</span><span style=color:#abb2bf>))</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span>
</span></span><span style=display:flex><span>               <span style=color:#abb2bf>((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x3f</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>uVar12</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>puVar2</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>0x20</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>local_68</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#abb2bf>((</span><span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>*</span> <span style=color:#98c379>&#39;\x02&#39;</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1U</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x3f</span><span style=color:#abb2bf>))</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span>
</span></span><span style=display:flex><span>               <span style=color:#abb2bf>((</span><span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_38</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>0x20U</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x3f</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>uVar12</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>bVar3</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_50</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>0x40</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>uVar13</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#abb2bf>((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_28</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x3f</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>uVar5</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar13</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar5</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>!=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>puVar2</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>bVar3</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>bVar3</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>      <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>^</span> <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>bVar3</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x3f</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_60</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar5</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>7</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar6</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0xf</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>*</span> <span style=color:#d19a66>2</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x17</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar7</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>4</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x1f</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>3</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar8</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>8</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x27</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>4</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar9</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x10</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x2f</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>5</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar10</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x20</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x37</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>6</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar11</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x40</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>lVar14</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>((</span><span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x3f</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>*</span> <span style=color:#54b1c7>-</span><span style=color:#d19a66>0x80</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>local_30</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar5</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar6</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar7</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar8</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar9</span> <span style=color:#54b1c7>+</span>
</span></span><span style=display:flex><span>               <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar10</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar11</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>lVar14</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>lVar14</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>^</span> <span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#abb2bf>((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_30</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x3f</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_50</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>^</span> <span style=color:#aa89ea>local_60</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_60</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x18</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>lVar14</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x18</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>*</span> <span style=color:#d19a66>0x100</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>lVar14</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x28</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x10</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar5</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff0000</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x30</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>iVar4</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar12</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>local_68</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x18</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>8</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x38</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>+</span>
</span></span><span style=display:flex><span>               <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x10</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x30</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>lVar14</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff00000000</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>+</span>
</span></span><span style=display:flex><span>               <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>uVar5</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x38</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x28</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>uVar12</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)</span><span style=color:#54b1c7>*</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span> <span style=color:#54b1c7>*</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>lVar14</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>8</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_68</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lu</span><span style=color:#d26464;font-weight:700>\n</span><span style=color:#98c379>&#34;</span><span style=color:#abb2bf>,</span><span style=color:#aa89ea>local_68</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></div><p>これを整理すると、</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#include</span> <span style=color:#8a93a5;font-style:italic>&lt;stdio.h&gt;</span><span style=color:#8a93a5;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>int</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>void</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#00b1f7>scanf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lu&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>loop_counter</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>scanf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lu&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>ans</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>scanf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lu&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>local_60</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#aa89ea>loop_counter</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>0x20</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>local_40</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>+=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>ans</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#abb2bf>((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>*</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>))</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#abb2bf>((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_40</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>+=</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>long</span><span style=color:#abb2bf>)((</span><span style=color:#e5c07b>unsigned</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)(</span><span style=color:#aa89ea>ans</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#abb2bf>((</span><span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>*</span> <span style=color:#d19a66>2</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1U</span><span style=color:#abb2bf>))</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#abb2bf>((</span><span style=color:#e5c07b>char</span><span style=color:#abb2bf>)</span><span style=color:#aa89ea>local_40</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>0x20U</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>bVar3</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>j</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>0x40</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>bVar3</span> <span style=color:#54b1c7>+=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#aa89ea>j</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>^=</span> <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#aa89ea>bVar3</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>uVar5</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>7</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>uVar6</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0xf</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>uVar7</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x17</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>uVar8</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x1f</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>3</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>uVar9</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x27</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>4</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>local_30</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>uVar5</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>uVar6</span> <span style=color:#54b1c7>+</span>
</span></span><span style=display:flex><span>                   <span style=color:#aa89ea>uVar7</span> <span style=color:#54b1c7>+</span> <span style=color:#aa89ea>uVar8</span> <span style=color:#54b1c7>+</span>
</span></span><span style=display:flex><span>                   <span style=color:#aa89ea>uVar9</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>^=</span> <span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_30</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x3f</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>^=</span> <span style=color:#aa89ea>local_50</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>ans</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x18</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xffffffff</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>          <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>8</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x38</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>          <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x10</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x30</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>          <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x18</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x8</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>          <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff00000000</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>          <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>(((</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x28</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x10</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span>          <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x30</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0xff</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>          <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>local_50</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#d19a66>0x38</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>0x28</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;%lu</span><span style=color:#d26464;font-weight:700>\n</span><span style=color:#98c379>&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>ans</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></div><p>となる。また、</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#76a9f9>for</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>j</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>0x40</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>j</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>bVar3</span> <span style=color:#54b1c7>+=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>local_60</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#aa89ea>j</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></div><p>は<code>local60</code>のbitの合計をとっているだけなので<code>popcnt</code>命令で計算することができる。ただ、これ以降の最適化を競技中には思いつくことができず、このまま提出したがこの段階ではテストケースの難易度が相当上がっていたようで時間制限に引っかかってしまった。しかも、最適化のためにコードをいじる時に誤って入力に<code>%lu</code>ではなく<code>%ld</code>を用いるよう書き換えてしまったようで、入力が大きい場合に正しく動作しないという致命的なバグを作ってしまった。Git等でバージョン管理した方が良かったかもしれない。</p><figure><img src=https://caphosra.net/images/2025-03-06/allegro6.png alt="Allegro Round6の結果"></figure><p>競技後に人から聞いた話では<code>pext</code>命令等を用いると良いとのことだった。</p><h2 id=最後に>最後に
<a class=heading-link href=#%e6%9c%80%e5%be%8c%e3%81%ab><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>運営の皆さん2日間ありがとうございました。もっと知識と技術をつけて出直してきます。</p><h2 id=付録1-時間の使い方>(付録1) 時間の使い方
<a class=heading-link href=#%e4%bb%98%e9%8c%b21-%e6%99%82%e9%96%93%e3%81%ae%e4%bd%bf%e3%81%84%e6%96%b9><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>会場にいる間はずっとAllegroにかかりっきりで、1日目と2日目の間はConnect_Sixに手をつけていた。石を積み上げてメモリ領域を破壊できる脆弱性と<code>score</code>が未初期化である脆弱性を見つけ、ガチャガチャやっても解けないまま2日目になっていた。</p><h2 id=付録2-会場の様子>(付録2) 会場の様子
<a class=heading-link href=#%e4%bb%98%e9%8c%b22-%e4%bc%9a%e5%a0%b4%e3%81%ae%e6%a7%98%e5%ad%90><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>会場は以下のような場所で各チームにテーブルが与えられている。2日目の競技開始前の様子だが、案外殺伐とした雰囲気ではなかった。</p><figure><img src=https://caphosra.net/images/2025-03-06/seccon_stage.jpg alt=SECCON会場の様子></figure><p>各チームのテーブルにはパネルとチーム名とアイコンが描かれた横断幕が設置されていた。</p><figure><img src=https://caphosra.net/images/2025-03-06/tsg.png alt=TSGのパネル width=50%></figure><p>会場の隣にはAlpaca Hackのブースがあり、アルパカのぬいぐるみが置かれていた。かわいい。会場随一の癒し。<figure><img src=https://caphosra.net/images/2025-03-06/alpaca.jpg alt="Alpaca Hack"></figure></p></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme"),themeInParams="";getTheme==null&&(themeInParams!==""&&themeInParams!=="auto"?getTheme=themeInParams:getTheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","caphosra/caphosra.github.io"),s.setAttribute("issue-term","title"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container><p>Footer? なにそれ美味しいの?</p>© 2019 - 2025
caphosra</section></footer></main></body></html>