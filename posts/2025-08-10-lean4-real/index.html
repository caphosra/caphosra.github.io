<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="caphosra"><meta name=description content="Lean4を使ってMathlib無しでDedekind cutを用いて実数を構成する。"><meta name=keywords content="lean4,real,実数,構成"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://caphosra.net/images/icon.webp"><meta name=twitter:title content="[Lean4] 実数を構成する"><meta name=twitter:description content="Lean4を使ってMathlib無しでDedekind cutを用いて実数を構成する。"><meta property="og:url" content="https://caphosra.net/posts/2025-08-10-lean4-real/"><meta property="og:site_name" content="caphosra note"><meta property="og:title" content="[Lean4] 実数を構成する"><meta property="og:description" content="Lean4を使ってMathlib無しでDedekind cutを用いて実数を構成する。"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-10T15:05:14+09:00"><meta property="article:modified_time" content="2025-08-13T12:40:28+09:00"><meta property="article:tag" content="Lean4"><base href=https://caphosra.net/posts/2025-08-10-lean4-real/><title>[Lean4] 実数を構成する · caphosra note</title><link rel=canonical href=https://caphosra.net/posts/2025-08-10-lean4-real/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><style defer>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap'</style><link rel=stylesheet href=https://caphosra.net/css/coder.min.e785694f058b8c1433bda14011e401202da0cbde72fc8f9e2ec92a230112ba08.css integrity="sha256-54VpTwWLjBQzvaFAEeQBIC2gy95y/I+eLskqIwESugg=" crossorigin=anonymous media=screen><script src=https://cdn.jsdelivr.net/npm/gist-embed@1.0.3/dist/gist-embed.min.js defer></script><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.148.2"><style type=text/css>.icon{font-size:2.5em}</style></head><body class=colorscheme-light><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://caphosra.net/>caphosra note
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://caphosra.net/>About</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/archives/>Archives</a></li><li class=navigation-item><a class=navigation-link href=https://github.com/caphosra>GitHub</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://caphosra.net/en/>English</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://caphosra.net/posts/2025-08-10-lean4-real/>[Lean4] 実数を構成する</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2025-08-10T15:05:14+09:00>8月 10, 2025
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
5分で読めます</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://caphosra.net/tags/lean4/>Lean4</a></span></div></div></header><div class=post-content><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><p>Lean4を使って有理数を構成してから実数を構成し、任意の有理数に対してそれに対応する実数の構成が確かにできることを示した。その過程をまとめたい。</p><h2 id=構成と証明したことの概要>構成と証明したことの概要
<a class=heading-link href=#%e6%a7%8b%e6%88%90%e3%81%a8%e8%a8%bc%e6%98%8e%e3%81%97%e3%81%9f%e3%81%93%e3%81%a8%e3%81%ae%e6%a6%82%e8%a6%81><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>まず前提として、Lean4の標準ライブラリにある、自然数を表現する<code>Nat</code>, 整数を表現する<code>Int</code>とそれに関する諸定理は断りなく使った。</p><p>その上で、整数と自然数の組\(\mathbb{Z}\times \mathbb{N}_{>0}\)(<code>NumPair</code>と命名)を定義し、これに対して、適当な同値関係\(\sim\)を定義した。この同値関係は、\((a, b) \sim (c, d) \Leftrightarrow ad = cb\)となるようなもので、整数の方を分子、自然数の方を分母とみなした時の分数のよくある同値関係を意味している。</p><p>次に、上記の同値関係を用いて、同値類\(\mathbb{Z}\times\mathbb{N}_{>0}/\sim\)をとり、その元を有理数<code>Rational</code>とした。</p><p>最後に、<code>Rational</code>の集合を用いて、Dedekind cutをとり実数<code>Real</code>を構成した。</p><p>証明については、任意の有理数\(r\)について\(\{x \in \mathbb{Q}|x &lt; r \}\)が、確かに実数の元となっていることを示した。この証明に際して\(\mathbb{Q}\)が稠密であることを示した。</p><h2 id=設けた縛り>設けた縛り
<a class=heading-link href=#%e8%a8%ad%e3%81%91%e3%81%9f%e7%b8%9b%e3%82%8a><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>今回、この構成と証明をするにあたって、個人的に以下の縛りを設けた。</p><ol><li>証明は<strong>排中律を使わずに</strong>行う。</li><li><strong>Mathlibは使わない。</strong></li></ol><p>まず、排中律を使わなかったことについて。今回は、構成的な証明にすることを目標としたので、排中律ならびにそれと同値の公理を利用しなかった。これにより、二重否定除去や背理法による証明ができなくなったが、今回の場合はなんとかなった。</p><p>次に、<a href=https://github.com/leanprover-community/mathlib4 class=external-link target=_blank rel=noopener>Mathlib</a>を使わないことについて。理由は主に2つある。1つはMathlibにはさまざまな有用な定理が収録されており、あまりにも便利すぎるから。そして、Mathlibのライブラリには背理法を行うtactic <code>by_contra</code>を用いた証明がかなり収録されていたはず<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>なので、意図しないうちに前述のルールを破ってしまう可能性があるからである。</p><p>ちなみにMathlibでは<code>Mathlib.Data.Real.Basic</code>において実数を表現する<code>Real</code>が定義されており、これはCauchy列を用いて定義されている。</p><h2 id=1-有理数の構成>1. 有理数の構成
<a class=heading-link href=#1-%e6%9c%89%e7%90%86%e6%95%b0%e3%81%ae%e6%a7%8b%e6%88%90><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>前置きはこれくらいにして、実際に実数を構成した過程を見ていく。</p><p>まず、有理数を構成するために、整数と自然数の組\(\mathbb{Z}\times \mathbb{N}_{>0}\), <code>NumPair</code>を定義した。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean data-lang=lean><span style=display:flex><span><span style=color:#76a9f9>structure</span> <span style=color:#aa89ea>NumPair</span> <span style=color:#76a9f9>where</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>num</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Int</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>denom</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Nat</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>denom_non_zero</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>≠</span> <span style=color:#d19a66>0</span>
</span></span></code></pre></div><p>ここでのポイントは、分母が0でないことを保証するために、<code>denom_non_zero</code>という要素を<code>NumPair</code>に追加している点である。</p><p>次に、<code>NumPair</code>に対して同値関係を定義した。これからこの関係を用いて有理数を定義するのだから、同値関係は以下のようになる。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>fun</span> <span style=color:#aa89ea>a</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>=&gt;</span> <span style=color:#aa89ea>a</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>b</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>=</span> <span style=color:#aa89ea>b</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>a</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span>
</span></span></code></pre></div><p>さて、この同値関係を持ちいて同値類をとりたいわけだが、Lean4では同値類<code>Quotient</code>をとるためには、数学でいうところの\((X, \sim)\)に相当する<code>Setoid</code>のインスタンスを定義する必要がある。そして、この<code>Setoid</code>のインスタンス定義には、ちゃんとこの2項関係が同値関係になっていることを示す必要がある。</p><p>この<code>Setoid</code>のインスタンス定義を行うと以下のようになる。<code>r</code>の部分が同値関係の定義を、<code>iseqv</code>の部分がそれがちゃんと同値関係になっていることの証明になっている。<code>case refl</code>と書いてあるところが反射律を、<code>case symm</code>が対称律を、<code>case trans</code>が推移律を示している部分である。推移律に関しては、掛け算の交換法則や結合法則を駆使して証明しているので、そこまで特別なことをしていないのに証明が長くなっている。<code>↑</code>はもちろんKnuthの矢印記法&mldr;ではなく、<code>Nat</code>を<code>Int</code>に変換するための記号である。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean data-lang=lean><span style=display:flex><span><span style=color:#76a9f9>instance</span> <span style=color:#aa89ea>NumPairSetoid</span> <span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Setoid</span> <span style=color:#aa89ea>NumPair</span> <span style=color:#76a9f9>where</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>r</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>fun</span> <span style=color:#aa89ea>a</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>=&gt;</span> <span style=color:#aa89ea>a</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>b</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>=</span> <span style=color:#aa89ea>b</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>a</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>iseqv</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>constructor</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>case</span> <span style=color:#aa89ea>refl</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>intros</span> <span style=color:#aa89ea>x</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rfl</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>case</span> <span style=color:#aa89ea>symm</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>intros</span> <span style=color:#aa89ea>x</span> <span style=color:#aa89ea>y</span> <span style=color:#aa89ea>h</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_comm</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>h</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_comm</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>case</span> <span style=color:#aa89ea>trans</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>intros</span> <span style=color:#aa89ea>x</span> <span style=color:#aa89ea>y</span> <span style=color:#aa89ea>z</span> <span style=color:#aa89ea>h1</span> <span style=color:#aa89ea>h2</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>have</span> <span style=color:#aa89ea>h1_mod</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>x</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>z</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>=</span> <span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>x</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>z</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>h1</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>have</span> <span style=color:#aa89ea>h2_mod</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>z</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>x</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>=</span> <span style=color:#aa89ea>z</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>x</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>h2</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>have</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>x</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>z</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>=</span> <span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>z</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>x</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_assoc</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_assoc</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>conv</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>lhs</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>conv</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>rhs</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_comm</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>have</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>*</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>x</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>z</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span><span style=color:#54b1c7>)</span> <span style=color:#e5c07b>=</span> <span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>*</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>z</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#e5c07b>↑</span><span style=color:#aa89ea>x</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>h1_mod</span><span style=color:#54b1c7>]</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>this</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>h2_mod</span><span style=color:#54b1c7>]</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>this</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>conv</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>this</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>lhs</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>conv</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>lhs</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_comm</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_assoc</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>conv</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>this</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>rhs</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>conv</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>lhs</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_comm</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_assoc</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>exact</span> <span style=color:#aa89ea>this</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>have</span> <span style=color:#aa89ea>y_denom_zero</span><span style=color:#54b1c7>:</span> <span style=color:#54b1c7>(</span><span style=color:#e5c07b>↑</span><span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Int</span><span style=color:#54b1c7>)</span> <span style=color:#e5c07b>≠</span> <span style=color:#d19a66>0</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>ofNat_ne_zero</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>exact</span> <span style=color:#aa89ea>y</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom_non_zero</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_eq_mul_left_iff</span> <span style=color:#aa89ea>y_denom_zero</span><span style=color:#54b1c7>]</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>this</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>exact</span> <span style=color:#aa89ea>this</span>
</span></span></code></pre></div><p>正直この証明は長いだけである。</p><p>この<code>Setoid</code>さえ定義してしまえば、有理数は以下のように定義できる。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>def</span> <span style=color:#aa89ea>Rational</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>Quotient</span> <span style=color:#aa89ea>NumPairSetoid</span>
</span></span></code></pre></div><h2 id=2-有理数の順序>2. 有理数の順序
<a class=heading-link href=#2-%e6%9c%89%e7%90%86%e6%95%b0%e3%81%ae%e9%a0%86%e5%ba%8f><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>有理数の定義はできたので、次は順序を定義する。</p><p>まず、\(\mathbb{Z}\times \mathbb{N}_{>0}\), <code>NumPair</code>に対して以下のように順序を定義した。Lean4において順序を定義するためには、<code>LT</code>のインスタンスを定義する必要がある。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>instance</span> <span style=color:#aa89ea>NumPairLT</span> <span style=color:#54b1c7>:</span> <span style=color:#aa89ea>LT</span> <span style=color:#aa89ea>NumPair</span> <span style=color:#76a9f9>where</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>lt</span> <span style=color:#aa89ea>a</span> <span style=color:#aa89ea>b</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>a</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>b</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>b</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>num</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>a</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>denom</span>
</span></span></code></pre></div><p>さて、あとはこの順序を有理数にliftして持ち込みたいが、そのためには、この順序が同値関係において保たれることを証明する必要がある。
つまり、\(a_1\sim a_2\)かつ\(b_1\sim b_2\)ならば、\(a_1&lt; b_1\)と\(a_2&lt; b_2\)は同値であることを示す必要がある。</p><p>これは\(a_1\sim a_2\)ならば、\(a_1&lt; b\)と\(a_2&lt; b\)は同値という補題<code>num_pair_lt_universal_left</code>と\(b_1\sim b_2\)ならば、\(a&lt; b_1\)と\(a&lt; b_2\)は同値という補題<code>num_pair_lt_universal_right</code>を証明してから示した。</p><p>証明は長いので省略する。標準ライブラリにある<code>Int.mul_lt_mul_of_pos_{left,right}</code>と<code>Int.lt_of_mul_lt_mul_{left,right}</code>を用いれば、面倒なものの比較的簡単に証明できる。最初はこの定理の存在に気づかず、帰納法を回してかなり大変なことになっていた。<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_lt_mul_of_pos_left</span> <span style=color:#54b1c7>{</span><span style=color:#aa89ea>a</span> <span style=color:#aa89ea>b</span> <span style=color:#aa89ea>c</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Int</span><span style=color:#54b1c7>}</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>h₁</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>b</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>h₂</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>0</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>c</span><span style=color:#54b1c7>):</span> <span style=color:#aa89ea>c</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>c</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>b</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_lt_mul_of_pos_right</span> <span style=color:#54b1c7>{</span><span style=color:#aa89ea>a</span> <span style=color:#aa89ea>b</span> <span style=color:#aa89ea>c</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Int</span><span style=color:#54b1c7>}</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>h₁</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>b</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>h₂</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>0</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>c</span><span style=color:#54b1c7>):</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>c</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>c</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>lt_of_mul_lt_mul_left</span> <span style=color:#54b1c7>{</span><span style=color:#aa89ea>a</span> <span style=color:#aa89ea>b</span> <span style=color:#aa89ea>c</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Int</span><span style=color:#54b1c7>}</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>w</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>c</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>h</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>0</span> <span style=color:#e5c07b>≤</span> <span style=color:#aa89ea>a</span><span style=color:#54b1c7>):</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>c</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>lt_of_mul_lt_mul_left</span> <span style=color:#54b1c7>{</span><span style=color:#aa89ea>a</span> <span style=color:#aa89ea>b</span> <span style=color:#aa89ea>c</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Int</span><span style=color:#54b1c7>}</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>w</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>c</span> <span style=color:#e5c07b>*</span> <span style=color:#aa89ea>a</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>h</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>0</span> <span style=color:#e5c07b>≤</span> <span style=color:#aa89ea>a</span><span style=color:#54b1c7>):</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>c</span>
</span></span></code></pre></div><p>こうして手に入れた定理<code>num_pair_lt_universal</code></p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>num_pair_lt_universal</span><span style=color:#54b1c7>{</span><span style=color:#aa89ea>a1</span> <span style=color:#aa89ea>a2</span> <span style=color:#aa89ea>b1</span> <span style=color:#aa89ea>b2</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>NumPair</span><span style=color:#54b1c7>}:</span> <span style=color:#aa89ea>a1</span> <span style=color:#e5c07b>≈</span> <span style=color:#aa89ea>a2</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>b1</span> <span style=color:#e5c07b>≈</span> <span style=color:#aa89ea>b2</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>a1</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>b1</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>a2</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>b2</span>
</span></span></code></pre></div><p>を用いて、有理数の順序を定義した。<code>by</code>以降はこの順序が同値関係において保たれることを示す証明である。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>instance</span> <span style=color:#aa89ea>RationalLT</span> <span style=color:#54b1c7>:</span> <span style=color:#aa89ea>LT</span> <span style=color:#aa89ea>Rational</span> <span style=color:#76a9f9>where</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>lt</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>lift₂</span> <span style=color:#54b1c7>(</span><span style=color:#76a9f9>fun</span> <span style=color:#aa89ea>x</span> <span style=color:#aa89ea>y</span> <span style=color:#e5c07b>=&gt;</span> <span style=color:#aa89ea>x</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>y</span><span style=color:#54b1c7>)</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>(</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>intros</span> <span style=color:#aa89ea>a_1</span> <span style=color:#aa89ea>b_1</span> <span style=color:#aa89ea>a_2</span> <span style=color:#aa89ea>b_2</span> <span style=color:#aa89ea>a_eq</span> <span style=color:#aa89ea>b_eq</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>simp</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>constructor</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>case</span> <span style=color:#aa89ea>mp</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>exact</span> <span style=color:#aa89ea>num_pair_lt_universal</span> <span style=color:#aa89ea>a_eq</span> <span style=color:#aa89ea>b_eq</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>case</span> <span style=color:#aa89ea>mpr</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#76a9f9>have</span> <span style=color:#aa89ea>a_eq&#39;</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>a_2</span> <span style=color:#e5c07b>≈</span> <span style=color:#aa89ea>a_1</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>exact</span> <span style=color:#aa89ea>NumPairSetoid</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>symm</span> <span style=color:#aa89ea>a_eq</span>
</span></span><span style=display:flex><span>          <span style=color:#76a9f9>have</span> <span style=color:#aa89ea>b_eq&#39;</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>b_2</span> <span style=color:#e5c07b>≈</span> <span style=color:#aa89ea>b_1</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>exact</span> <span style=color:#aa89ea>NumPairSetoid</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>symm</span> <span style=color:#aa89ea>b_eq</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>exact</span> <span style=color:#aa89ea>num_pair_lt_universal</span> <span style=color:#aa89ea>a_eq&#39;</span> <span style=color:#aa89ea>b_eq&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>)</span>
</span></span></code></pre></div><p>ところで、順序をliftするのに使った<code>Quotient.lift₂</code>は以下のような型を持つ。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>abbrev</span> <span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>lift₂</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>{</span><span style=color:#aa89ea>α</span><span style=color:#54b1c7>:</span> <span style=color:#e5c07b>Sort</span> <span style=color:#aa89ea>uA</span><span style=color:#54b1c7>}</span> <span style=color:#54b1c7>{</span><span style=color:#aa89ea>β</span><span style=color:#54b1c7>:</span> <span style=color:#e5c07b>Sort</span> <span style=color:#aa89ea>uB</span><span style=color:#54b1c7>}</span> <span style=color:#54b1c7>{</span><span style=color:#aa89ea>φ</span><span style=color:#54b1c7>:</span> <span style=color:#e5c07b>Sort</span> <span style=color:#aa89ea>uC</span><span style=color:#54b1c7>}</span> <span style=color:#54b1c7>{</span><span style=color:#aa89ea>s₁</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Setoid</span> <span style=color:#aa89ea>α</span><span style=color:#54b1c7>}</span> <span style=color:#54b1c7>{</span><span style=color:#aa89ea>s₂</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Setoid</span> <span style=color:#aa89ea>β</span><span style=color:#54b1c7>}</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>(</span><span style=color:#aa89ea>f</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>α</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>β</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>φ</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>c</span><span style=color:#54b1c7>:</span> <span style=color:#e5c07b>∀</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>a₁</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>α</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>b₁</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>β</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>a₂</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>α</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>b₂</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>β</span><span style=color:#54b1c7>),</span> <span style=color:#aa89ea>a₁</span> <span style=color:#e5c07b>≈</span> <span style=color:#aa89ea>a₂</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>b₁</span> <span style=color:#e5c07b>≈</span> <span style=color:#aa89ea>b₂</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>f</span> <span style=color:#aa89ea>a₁</span> <span style=color:#aa89ea>b₁</span> <span style=color:#e5c07b>=</span> <span style=color:#aa89ea>f</span> <span style=color:#aa89ea>a₂</span> <span style=color:#aa89ea>b₂</span><span style=color:#54b1c7>)</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>(</span><span style=color:#aa89ea>q₁</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Quotient</span> <span style=color:#aa89ea>s₁</span><span style=color:#54b1c7>)</span> <span style=color:#54b1c7>(</span><span style=color:#aa89ea>q₂</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Quotient</span> <span style=color:#aa89ea>s₂</span><span style=color:#54b1c7>)</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>:</span> <span style=color:#aa89ea>φ</span>
</span></span></code></pre></div><p>ぱっと見だと面食らってしまうかもしれないが(実際私もLean4のドキュメントを眺めてて見つけた時には面食らった)、冷静に見てみると、2つの引数を取る関数<code>f</code>について、同値関係によって結果が変わらないことの証明<code>c</code>を与えればそれをliftした関数を与えてくれることが読み取れるだろう。特に、<code>f</code>と<code>c</code>のみを与えることで、<code>Quotient s₁ → Quotient s₂ → φ</code>になってくれるのは大変使い勝手が良くて嬉しい。</p><p>ちなみに、先に<code>q₁: Quotient s₁, q₂: Quotient s₂</code>を与えてしまう<code>Quotient.liftOn₂</code>というものも定義されているので、そちらを使うこともできる。</p><h2 id=3-集合の定義>3. 集合の定義
<a class=heading-link href=#3-%e9%9b%86%e5%90%88%e3%81%ae%e5%ae%9a%e7%be%a9><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>集合については、Lean3から続く慣習に従って</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>def</span> <span style=color:#aa89ea>Set</span> <span style=color:#aa89ea>α</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>α</span> <span style=color:#e5c07b>→</span> <span style=color:#e5c07b>Prop</span>
</span></span></code></pre></div><p>と定義した。つまり、集合をある型を持つ値に対してそれが属すかどうかを返す関数として定義した。この定義においては、型によっては集合ではなくクラスになる気もするが、今回の場合には有理数全体は集合になるので問題にならないと考えている。</p><h2 id=4-実数の構成>4. 実数の構成
<a class=heading-link href=#4-%e5%ae%9f%e6%95%b0%e3%81%ae%e6%a7%8b%e6%88%90><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>集合と有理数の順序を定義したので、あとは実数を構成するだけである。ここまで道具を揃えてしまえば、素直に書き下すだけで定義できてしまう。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>structure</span> <span style=color:#aa89ea>Real</span> <span style=color:#76a9f9>where</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>partition</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Set</span> <span style=color:#aa89ea>Rational</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>partition_non_empty</span><span style=color:#54b1c7>:</span> <span style=color:#e5c07b>∃</span><span style=color:#aa89ea>x</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x</span> <span style=color:#e5c07b>∈</span> <span style=color:#aa89ea>partition</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>partition_not_all</span><span style=color:#54b1c7>:</span> <span style=color:#e5c07b>∃</span><span style=color:#aa89ea>x</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x</span> <span style=color:#e5c07b>∉</span> <span style=color:#aa89ea>partition</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>partition_closed</span><span style=color:#54b1c7>:</span> <span style=color:#e5c07b>∀</span><span style=color:#aa89ea>x</span> <span style=color:#aa89ea>y</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>y</span> <span style=color:#e5c07b>∧</span> <span style=color:#aa89ea>y</span> <span style=color:#e5c07b>∈</span> <span style=color:#aa89ea>partition</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>x</span> <span style=color:#e5c07b>∈</span> <span style=color:#aa89ea>partition</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>partition_open</span><span style=color:#54b1c7>:</span> <span style=color:#e5c07b>∀</span><span style=color:#aa89ea>x</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x</span> <span style=color:#e5c07b>∈</span> <span style=color:#aa89ea>partition</span> <span style=color:#e5c07b>→</span> <span style=color:#e5c07b>∃</span><span style=color:#aa89ea>y</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>y</span> <span style=color:#e5c07b>∧</span> <span style=color:#aa89ea>y</span> <span style=color:#e5c07b>∈</span> <span style=color:#aa89ea>partition</span>
</span></span></code></pre></div><h2 id=5-有理数に対応する実数の構成>5. 有理数に対応する実数の構成
<a class=heading-link href=#5-%e6%9c%89%e7%90%86%e6%95%b0%e3%81%ab%e5%af%be%e5%bf%9c%e3%81%99%e3%82%8b%e5%ae%9f%e6%95%b0%e3%81%ae%e6%a7%8b%e6%88%90><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>最後に、任意の有理数に対してそれに対応する実数の構成が確かにDedekind cutになっていることを示した。</p><p>ここでいう「対応する実数の構成」とは、\(r\)という有理数に対して、\(\{x \in \mathbb{Q}|x &lt; r \}\)を意味する。もちろん、有理数に対してどのような実数を対応づけるかの方法は無数にあるが、少なくとも私はこの構成がよく用いられていると認識しているのでこれを採用した。</p><p>命題を示すためには、Dedekind cutの定義から、以下の4つの定理を示せばよい。</p><ol><li>\(\forall r \in \mathbb{Q}, \exists r&rsquo; \in \mathbb{Q}, r&rsquo; &lt; r\)</li><li>\(\forall r \in \mathbb{Q}, \exists r&rsquo; \in \mathbb{Q}, \neg(r&rsquo; &lt; r)\)</li><li>\(\forall r\:r_1\:r_2 \in \mathbb{Q}, r_1 &lt; r_2 \land r_2 &lt; r \Rightarrow r_1 &lt; r\)</li><li>\(\forall r\:r&rsquo; \in \mathbb{Q}, r&rsquo; &lt; r \Rightarrow \exists r&rsquo;&rsquo; \in \mathbb{Q}, r&rsquo; &lt; r&rsquo;&rsquo; &lt; r\)</li></ol><p>特にこの定理のうち最後の1つは、有理数が稠密であることを意味している。</p><p>有理数は\(\mathbb{Z}\times \mathbb{N}_{>0}\), <code>NumPair</code>の同値類として定義したので、この定理の証明を得るためには、<code>NumPair</code>でこれらの定理を証明してliftすれば良い。</p><p>つまり、示すべきなのは以下の定理になる。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>num_pair_exists_lt</span><span style=color:#54b1c7>(</span><span style=color:#aa89ea>a</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>NumPair</span><span style=color:#54b1c7>):</span> <span style=color:#e5c07b>∃</span><span style=color:#aa89ea>b</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>NumPair</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>a</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>num_pair_exists_not_lt</span><span style=color:#54b1c7>(</span><span style=color:#aa89ea>a</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>NumPair</span><span style=color:#54b1c7>):</span> <span style=color:#e5c07b>∃</span><span style=color:#aa89ea>b</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>NumPair</span><span style=color:#54b1c7>,</span> <span style=color:#e5c07b>¬</span><span style=color:#aa89ea>b</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>a</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>num_pair_lt_of_lt_lt</span><span style=color:#54b1c7>{</span><span style=color:#aa89ea>a</span> <span style=color:#aa89ea>b</span> <span style=color:#aa89ea>c</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>NumPair</span><span style=color:#54b1c7>}:</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>c</span> <span style=color:#e5c07b>→</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>c</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>num_pair_exists_between</span><span style=color:#54b1c7>{</span><span style=color:#aa89ea>a</span> <span style=color:#aa89ea>b</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>NumPair</span><span style=color:#54b1c7>}:</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>b</span> <span style=color:#e5c07b>→</span> <span style=color:#e5c07b>∃</span><span style=color:#aa89ea>c</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>NumPair</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>c</span> <span style=color:#e5c07b>∧</span> <span style=color:#aa89ea>c</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>b</span>
</span></span></code></pre></div><p>1,2,4番目は実際に<code>NumPair</code>を構成することで証明できる。1番目は、\((a_1,a_2)\)に対して\((a_1 - 1,a_2)\)を、2番目は\((a_1,a_2)\)に対して\((a_1 + 1,a_2)\)を、4番目は\((a_1,a_2),(b_1,b_2)\)に対して\((a_1b_2 + b_1a_2, 2a_2b_2)\)を例として構成した。4番目は平均値に相当する。</p><p>余談だが、最初は4番目で\((2a_1b_2 + 1, 2a_2b_2)\)を例として出していた。これだと、途中で出てくる\(2a_1b_2 + 1 &lt; 2b_1a_2\)の証明があまりにも煩雑になってしまうので、大変苦労した。実際に行った平均値を取る方法を用いれば、代わりに\(2a_1b_2 &lt; a_1b_2 + b_1a_2\)と\(a_1b_2 + b_1a_2 &lt; 2b_1a_2\)を証明することになる。これは</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>theorem</span> <span style=color:#aa89ea>int_two_mul</span><span style=color:#54b1c7>{</span><span style=color:#aa89ea>n</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Int</span><span style=color:#54b1c7>}:</span> <span style=color:#aa89ea>n</span> <span style=color:#e5c07b>*</span> <span style=color:#d19a66>2</span> <span style=color:#e5c07b>=</span> <span style=color:#aa89ea>n</span> <span style=color:#e5c07b>+</span> <span style=color:#aa89ea>n</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>conv</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>rhs</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>congr</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>case</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>one_mul</span> <span style=color:#aa89ea>n</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>case</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>=&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>one_mul</span> <span style=color:#aa89ea>n</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>add_mul</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>simp</span> <span style=color:#54b1c7>[</span><span style=color:#aa89ea>Int</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mul_comm</span><span style=color:#54b1c7>]</span>
</span></span></code></pre></div><p>という風に<code>n * 2</code>を<code>n + n</code>に書き換える定理をあらかじめ証明しておくと瞬殺できる。例の選び方は証明の長さに直結することを実感した。</p><p>3番目の定理は、先述の<code>Int.mul_lt_mul_of_pos_right</code>と<code>Int.lt_of_mul_lt_mul_right</code>を使えばかなり簡潔に証明できた。</p><p>これらの定理を証明し、ついに有理数を実数に対応付ける関数を定義することができた。かなり長いが、やっていることは、同値類の代表元を取ってきて先ほどの定理を適用する作業を行なっているだけである。それぞれの<code>by</code>が定理1, 2, 3, 4に対応している。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#76a9f9>def</span> <span style=color:#aa89ea>real_of_rational</span><span style=color:#54b1c7>(</span><span style=color:#aa89ea>rational</span><span style=color:#54b1c7>:</span> <span style=color:#aa89ea>Rational</span><span style=color:#54b1c7>):</span> <span style=color:#aa89ea>Real</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Real</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mk</span> <span style=color:#54b1c7>(</span><span style=color:#76a9f9>fun</span> <span style=color:#aa89ea>x</span> <span style=color:#e5c07b>=&gt;</span> <span style=color:#aa89ea>x</span> <span style=color:#e5c07b>&lt;</span> <span style=color:#aa89ea>rational</span><span style=color:#54b1c7>)</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>(</span><span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>simp</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>rational&#39;</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>rational&#39;_sat</span><span style=color:#e5c07b>⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>exists_rep</span> <span style=color:#aa89ea>rational</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>rational&#39;_sat</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>x</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x_sat</span><span style=color:#e5c07b>⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>num_pair_exists_lt</span> <span style=color:#aa89ea>rational&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>exact</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mk</span> <span style=color:#aa89ea>NumPairSetoid</span> <span style=color:#aa89ea>x</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x_sat</span><span style=color:#e5c07b>⟩</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>)</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>(</span><span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>simp</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>rational&#39;</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>rational&#39;_sat</span><span style=color:#e5c07b>⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>exists_rep</span> <span style=color:#aa89ea>rational</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>rational&#39;_sat</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>x</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x_sat</span><span style=color:#e5c07b>⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>num_pair_exists_not_lt</span> <span style=color:#aa89ea>rational&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>exact</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mk</span> <span style=color:#aa89ea>NumPairSetoid</span> <span style=color:#aa89ea>x</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x_sat</span><span style=color:#e5c07b>⟩</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>)</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>(</span><span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>simp</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>intros</span> <span style=color:#aa89ea>x</span> <span style=color:#aa89ea>y</span> <span style=color:#aa89ea>x_lt_y</span> <span style=color:#aa89ea>y_lt_r</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>x&#39;</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x&#39;_sat</span><span style=color:#e5c07b>⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>exists_rep</span> <span style=color:#aa89ea>x</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>y&#39;</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>y&#39;_sat</span><span style=color:#e5c07b>⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>exists_rep</span> <span style=color:#aa89ea>y</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>r&#39;</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>r&#39;_sat</span><span style=color:#e5c07b>⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>exists_rep</span> <span style=color:#aa89ea>rational</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>x&#39;_sat</span><span style=color:#54b1c7>]</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>x_lt_y</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>y&#39;_sat</span><span style=color:#54b1c7>]</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>x_lt_y</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>y&#39;_sat</span><span style=color:#54b1c7>]</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>y_lt_r</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>r&#39;_sat</span><span style=color:#54b1c7>]</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>y_lt_r</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#aa89ea>h</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>num_pair_lt_of_lt_lt</span> <span style=color:#aa89ea>x_lt_y</span> <span style=color:#aa89ea>y_lt_r</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>x&#39;_sat</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>r&#39;_sat</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>exact</span> <span style=color:#aa89ea>h</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>)</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>(</span><span style=color:#76a9f9>by</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>simp</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>intros</span> <span style=color:#aa89ea>x</span> <span style=color:#aa89ea>h</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>x&#39;</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>x&#39;_sat</span><span style=color:#e5c07b>⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>exists_rep</span> <span style=color:#aa89ea>x</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>r&#39;</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>r&#39;_sat</span><span style=color:#e5c07b>⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>exists_rep</span> <span style=color:#aa89ea>rational</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>x&#39;_sat</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>r&#39;_sat</span><span style=color:#54b1c7>]</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>x&#39;_sat</span><span style=color:#54b1c7>]</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>h</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>rw</span> <span style=color:#54b1c7>[</span><span style=color:#e5c07b>←</span><span style=color:#aa89ea>r&#39;_sat</span><span style=color:#54b1c7>]</span> <span style=color:#76a9f9>at</span> <span style=color:#aa89ea>h</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>let</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>c</span><span style=color:#54b1c7>,</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>c_x_sat</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>c_r_sat</span><span style=color:#e5c07b>⟩⟩</span> <span style=color:#54b1c7>:</span><span style=color:#e5c07b>=</span> <span style=color:#aa89ea>num_pair_exists_between</span> <span style=color:#aa89ea>h</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>exact</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>Quotient</span><span style=color:#e5c07b>.</span><span style=color:#aa89ea>mk</span> <span style=color:#aa89ea>NumPairSetoid</span> <span style=color:#aa89ea>c</span><span style=color:#54b1c7>,</span> <span style=color:#e5c07b>⟨</span><span style=color:#aa89ea>c_x_sat</span><span style=color:#54b1c7>,</span> <span style=color:#aa89ea>c_r_sat</span><span style=color:#e5c07b>⟩⟩</span>
</span></span><span style=display:flex><span>    <span style=color:#54b1c7>)</span>
</span></span></code></pre></div><h2 id=6-使った公理の確認>6. 使った公理の確認
<a class=heading-link href=#6-%e4%bd%bf%e3%81%a3%e3%81%9f%e5%85%ac%e7%90%86%e3%81%ae%e7%a2%ba%e8%aa%8d><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>細心の注意を払ってきたが、念のために排中律と同等な公理を使っていないか確認する。Lean4では<code>#print axioms</code>を使うことで、その定理が依存している公理を確認することができる。実際にやってると、</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lean4 data-lang=lean4><span style=display:flex><span><span style=color:#e5c07b>#</span><span style=color:#aa89ea>print</span> <span style=color:#aa89ea>axioms</span> <span style=color:#aa89ea>real_of_rational</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&#39;real_of_rational&#39; depends on axioms: [propext, Quot.sound]
</span></span></code></pre></div><p>となる。</p><p><code>propext</code>は論理的な同値関係を数学的な等式として扱うことを許す公理である。つまり、\(a\leftrightarrow b\)ならば\(a = b\)とする公理である。<code>Quot.sound</code>は、同値な元の同値類を等号で結んで良いという公理である。つまり、\(a \sim b\)ならば\(a\)の同値類と\(b\)の同値類は等しいという公理である。<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></p><p><del><code>Classical.choice</code>は空でないものから1つ具体的に値を取ってくることを許す公理であり、排中律と同値であることが知られている。今回の証明では、この<code>Classical.choice</code>に依存していないことが確認できたので、目標は達成できたと言えるだろう。</del></p><h4 id=813追記>8/13追記
<a class=heading-link href=#813%e8%bf%bd%e8%a8%98><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h4><p><code>Classical.choice</code>と排中律が同値であることは知られていない。Diaconescuの定理から<code>Classical.choice</code>ならば排中律<code>Classical.em</code>は出るが、逆はそうではない。<code>Classical.choice</code>は冷静に考えると選択公理そのもので、排中律から出たらかなりまずい。</p><p>よって、<code>#print axioms</code>によって排中律を使っていないことを厳密には確認できないが、<code>Classical.em</code>を使っていたとしたらLeanにおける排中律の定義の問題で<code>Classical.choice</code>が依存関係に出てくるので、少なくとも明示的に利用されている場所はないことがわかる。</p><h2 id=最後に>最後に
<a class=heading-link href=#%e6%9c%80%e5%be%8c%e3%81%ab><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>Mathlibと排中律を使わずに実数を構成し、よくある有理数に対応する実数の構成が確かにDedekind cutになっていることを示した。</p><p>証明にはかなりの時間を要した。これは「難しい証明を行なっているから」というよりは、自分が実数の構成についてちゃんと理解できているのかを確かめるために極力何かを参照せず定義を思い出しながら書いていったこと、証明でやるべきことが明快でもいざLean4を通してみると案の定コーナーケースが大量に出てきたこと、お世辞にも使いやすいとはいえない<a href=https://leanprover-community.github.io/mathlib4_docs/ class=external-link target=_blank rel=noopener>公式のドキュメントの検索</a>を使って使えそうな定理を探す必要があったことに起因する。</p><p>おかげさまで、こういう定理は登録されていそう、登録されていなさそう、もし登録されているのなら、こういう名前で登録されているだろうという勘が少し働くようになった。HaskellでいうところのHoogleみたいなのがあると便利だと感じたので、もしかしたら作るかもしれない。</p><p>最後はLean4の愚痴っぽくなってしまったが、理解した気になっている定義・定理をLean4で書いてみると、「タイパ」は悪いかもしれないが楽しく自分の理解を深めることができるので、興味のある方はぜひ試してみてほしい。</p><h4 id=813追記-1>8/13追記
<a class=heading-link href=#813%e8%bf%bd%e8%a8%98-1><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h4><p>Hoogleのように定理を検索できる<a href=https://loogle.lean-lang.org/ class=external-link target=_blank rel=noopener>Loogle</a>というものがあるらしい。次から使ってみる。</p><h2 id=ソースコード>ソースコード
<a class=heading-link href=#%e3%82%bd%e3%83%bc%e3%82%b9%e3%82%b3%e3%83%bc%e3%83%89><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>証明を全文読みたい方は以下からどうぞ。</p><p><a href=https://github.com/caphosra/real_in_real/tree/main/RealInReal class=external-link target=_blank rel=noopener>GitHub caphosra/real_in_real</a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>要出典。含むか含まないかわからないなら使わない方が良いと思って回避した側面もある。ちなみに、含むか含まないのどちらかであるとすることは排中律を仮定している。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>もちろん、それでも証明はできる。が、如何せん長い。&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>あんまり詳しいことは知らないので、有識者の方お願いします。&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme"),themeInParams="";getTheme==null&&(themeInParams!==""&&themeInParams!=="auto"?getTheme=themeInParams:getTheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","caphosra/caphosra.github.io"),s.setAttribute("issue-term","title"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container><p>Footer? なにそれ美味しいの?</p>© 2019 - 2025
caphosra</section></footer></main></body></html>